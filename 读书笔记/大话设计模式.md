### 

#### 工厂模式

简单工厂实现了客户端与具体产品创建过程的解耦。在一个山寨手机厂里，同时生产苹果手机与华为手机。

工厂模式实现了各个工厂的解耦。所有产品的创建不再耦合在一个简单工厂类里。正品厂家，苹果厂与华为厂互相独立，彼此生产过程没有耦合。

抽象工厂，扩展了产品种类。苹果厂新增了平板生产线，苹果厂同时生产苹果手机与苹果手机壳。华为同理。

（注：抽象工厂主要针对产品种类的增加）。

现在有句流行的话“讨厌没有边界感的人”，工厂模式就是为了制造代码中的边界感。

书中以数据库的切换问题为例，用工厂模式实现了数据库的一键切换。最终借助反射+配置实现了免编译切换数据库。

并且引入简单工厂，优化了最后的抽象工厂模式，削减了各种抽象厂类的数量。印证了抽象工厂只是强调在生产“一套产品”，好比手机与手机壳。

最后，客户端不再接触抽象工厂接口，只接触一个简单工厂和抽象产品。

设计模式的改进也好比人类社会生产的改进一样，伴随着分工的不断细化。

### 软件设计原则

开闭原则，是最重要最根本的原则。可以说其他原则的目标就是为了实现开闭原则。

单一职责原则，横向解耦，狗就去看门，不要代替猫。

依赖倒置原则，竖向解耦，高低模块不要直接接触，通过接口交互。（Spring 框架的对象容器也可以看做这一原则的实现，依赖对象时不要直接创建，借助对象容器自动注入）。

所有原则都是为了解耦，解耦的最重要目标也是为了实现开闭原则。

### lg教育：

#### Mybatis

自定义jdbc框架：

- SqlSession好比一个数据库遥控器，根据接口方法名，找到相应的sql，执行jdbc代码。好比在空调遥控器上输入数字指令，空调输出相应的温度。

- Executor好比空调的信号接收系统及制冷部件。

- 在约定下（接口的方法与配置文件sql的id保持一致）,借助动态代理，规避了硬编码sql语句id的问题。

- SqlSession好比公司的公关部，前台，负责公司的门面和接待。Executor好比公司的研发部，复杂繁琐的工作细节在这里处理。

约定，动态代理，工厂模式->避免sql硬编码，封装了jdbc执行细节->符合了开闭原则

#### ioc与aop

出现前：

1. 一个对象被几百个地方引用，new出来。如果这个对象名字变了，或方法变了，需要改动几百个地方。

2. 想在所有方法里，打日志记录下执行时间。需要在成千上万的方法里重复写日志代码。

ioc与aop解决的问题

- 为了消除new，降低对象之间耦合度，引入ioc，对象容器，统一管理对象的创建与依赖关系。

- 为了消除横切逻辑（事务，日志，权限）对业务代码的入侵，引入aop，通过动态代理来做方法增强。消除了横切代码的重复性和对业务代码的入侵。

ioc的演化之路：

- 自定义ioc框架，引入工厂模式，用一个工厂类和xml管理需要依赖的对象。

- Spring ioc通过xml创建对象的三种方式，1，指定类；2，指定一个静态方法；3，指定一个bean的实例方法。后两种（指定一个工厂方法）比较少用，有些创建过程复杂的类可能会用。

- Spring ioc创建bean的更高级方式，FactoryBean类。有了FactoryBean类后，我们就用它来创建复杂的Bean，不用上面的后两种创建方式（指定一个工厂方法）。

从Spring ioc的接口角度看待设计：顶层接口也是和我们自定义框架一样的BeanFactory，子接口ApplicationContext 又提供设计了读取配置等功能。子接口拥有更多的功能。对比一下，我们的自定义ioc框架，读取配置文件是一个单独的工具类。因此Spring ioc框架的子接口功能更全面，我们通常也是直接用Spring的子接口。

Spring IOC的启动

- SE应用，直接创建一个容器类对象，和我们自定义框架使用一样

- WEB应用，配置启动监听器类（容器类实现监听器接口）。如果使用全注解模式，需要将配置类注入监听类中。

Spring ioc从xml模式向注解模式演化

- xml模式，与自定义ioc框架相同

- xml注解混合，入口还是xml文件。xml中配置一个scan-package属性，指定注解bean所在的包。在这里还把数据库配置抽取为单独的配置文件，在xml指定属性文件路径。

- 纯注解模式。@Configuration配置类，作为ioc入口，@Properties指定属性配置文件。

其他

- @Lazy体会注解的用法。设置默认值true。加上注解，默认直接生效

- @Conditional。matchIfMissing，指定没有读到执行的配置时，注解返回的值。

- ThreadLocal，本质是当前ThreadLocal对象作为key，在当前线程绑定的map集合中存入一个元素。所以ThreadLocal对象应该是一个单例对象。两种方式（1，作为一个单例对象的实例成员 2，作为一个类成员去使用）。如果作为多例对象的成员，就会导致在线程map中存了多份，无法共享。

- 动态代理，运行时动态生成的代理对象（匿名）在实现接口的方法中，利用反射技术，在执行（也可以不执行）被代理对象方法前后，做一些增强操作（日志，事务，鉴权等）。披了羊皮的狼，更方便的吃羊，吃羊方式被增强。

ioc像家具陈设布局合理的房间。aop像抹布，把房间、家具上的垃圾（重复的代码）擦干净。











#### 做事的技巧

- 毛选中，情况明，决心大，方法对

- 暗示，做一个俯卧撑，就赢了。看一页书，就学到知识了。人都会自我合理化，一旦开始，就会延续下去。

#### 沟通技巧

- 不要拒绝，有条件的答应。（可以做，给...时间。等有时间评估下...）。有点像《小镇喧嚣》中的媚。
